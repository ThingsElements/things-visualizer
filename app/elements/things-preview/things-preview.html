<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../../bower_components/firebase-element/firebase-collection.html">
<link rel="import" href="../../bower_components/firebase-element/firebase-document.html">

<link rel="import" href="../../bower_components/things-global-behavior/things-global-behavior.html">
<link rel="import" href="../../bower_components/things-scene-3d-viewer/things-scene-3d-viewer.html">

<link rel="import" href="./things-model-behavior.html">

<dom-module id="things-preview">
  <template>
    <style>
      :host {
        display: inline-flex;
        @apply(--layout-vertical);
      }

      things-scene-3d-viewer {
        @apply(--layout-flex)
      }

      paper-fab {
        position: absolute;
        bottom: 42px;
        right: 16px;
      }
    </style>

    <things-scene-3d-viewer model="[[model]]" data="[[data]]">
    </things-scene-3d-viewer>

    <paper-fab noink id="print" icon="icons:print" title="print"></paper-fab>

    <firebase-document
      location="https://glowing-fire-6105.firebaseio.com"

      data="{{data}}">
    </firebase-document>

  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'things-preview',

        properties: {
          scene: {
            notify: true
          },
          model: {
            notify: true
          },
          route: {
            notify:true,
            observer: 'onRouteChanged'
          },
          data: {
            observer: 'onDataChanged'
          }
        },

        behaviors: [
          ThingsModelBehavior,
          Things.GlobalBehavior
        ],

        listeners: {
          'print.tap': 'onTapPrint'
        },

        ready: function() {

        },

        attached: function() {
        },

        detached: function() {
        },

        onDataChanged: function(data) {
          this.data = data
        },

        _getModelSuccess: function(event) {
          var result = JSON.parse(event.detail.response);
          console.log('_getModelSuccess', result)

          if (result.code === 'NG') {
            console.log('error')
          }
        },

        onTapPrint: function(e) {
        },

        onRouteChanged: function(route) {

          /* route가 변경되었을 때만, 작동한다. 편법이지만. */
          if(this.scene && route === this.getAttribute('data-route'))
            this.model = this.scene.model
        }
      });
    })();
  </script>
</dom-module>
